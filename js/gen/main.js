function name(t){return t.name}function group(t){return t.group}function colorByGroup(t){return color(group(t))}function recenterVoronoi(t){var n=[];return voronoi(t).forEach(function(t){if(t.length){var r=[];t.forEach(function(n){r.push([n[0]-t.point.x,n[1]-t.point.y])}),r.point=t.point,n.push(r)}}),n}var color=d3.scale.category10(),width=960,height=500,svg=d3.select("#viz").append("svg").attr("width",width).attr("height",height),node,link,voronoi=d3.geom.voronoi().x(function(t){return t.x}).y(function(t){return t.y}).clipExtent([[-10,-10],[width+10,height+10]]),force=d3.layout.force().charge(-2e3).friction(.3).linkDistance(50).size([width,height]);force.on("tick",function(){node.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("clip-path",function(t){return"url(#clip-"+t.index+")"}),link.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y});var t=svg.selectAll(".clip").data(recenterVoronoi(node.data()),function(t){return t.point.index});t.enter().append("clipPath").attr("id",function(t){return"clip-"+t.point.index}).attr("class","clip"),t.exit().remove(),t.selectAll("path").remove(),t.append("path").attr("d",function(t){return"M"+t.join(",")+"Z"})}),d3.json("tags.json",function(t,n){n.nodes.forEach(function(t,n){t.id=n}),link=svg.selectAll(".link").data(n.links).enter().append("line").attr("class","link").style("stroke-width",function(t){return Math.sqrt(t.value)}),node=svg.selectAll(".node").data(n.nodes).enter().append("g").attr("title",name).attr("class","node").call(force.drag),node.append("circle").attr("r",30).attr("fill",colorByGroup).attr("fill-opacity",.5),node.append("text").attr("y",-10).text(function(t){return t.name}),node.append("circle").attr("r",4).attr("stroke","black"),force.nodes(n.nodes).links(n.links).start()});